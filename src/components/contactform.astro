---
import Button from "./ui/astroButton.astro";
---

<!-- To make this contact form work, create your free access key from https://web3forms.com/
     Then you will get all form submissions in your email inbox. -->
<form
  action="https://api.web3forms.com/submit"
  method="POST"
  id="form"
  class="needs-validation backdrop-blur-lg bg-white/70 dark:bg-black/10 rounded-2xl p-1 shadow-xl"
  novalidate>
  <div class="bg-white/80 dark:bg-black/40 rounded-2xl p-6 md:p-8">
    <input type="hidden" name="access_key" value="YOUR_ACCESS_KEY_HERE" />
    <!-- Create your free access key from https://web3forms.com/ -->
    <input
      type="checkbox"
      class="hidden"
      style="display:none"
      name="botcheck"
    />

    <div class="space-y-6">
      <!-- Name Field -->
      <div class="relative">
        <label
          for="name"
          class="text-sm font-medium text-gray-700 mb-1 block dark:text-gray-300"
          >Full Name</label
        >
        <div class="relative">
          <input
            type="text"
            id="name"
            placeholder="Enter your name"
            required
            class="w-full pl-10 px-4 py-3 bg-white/80 dark:bg-black/30 border border-gray-300 dark:border-gray-700 placeholder:text-gray-500 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 text-gray-800 dark:text-white"
            name="name"
          />
          <div
            class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-gray-500">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true">
              <path
                fill-rule="evenodd"
                d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="empty-feedback invalid-feedback text-red-500 text-sm mt-1">
          Please provide your full name.
        </div>
      </div>

      <!-- Email Field -->
      <div class="relative">
        <label
          for="email_address"
          class="text-sm font-medium text-gray-700 mb-1 block dark:text-gray-300"
          >Email Address</label
        >
        <div class="relative">
          <input
            id="email_address"
            type="email"
            placeholder="Enter your email"
            name="email"
            required
            class="w-full pl-10 px-4 py-3 bg-white/80 dark:bg-black/30 border border-gray-300 dark:border-gray-700 placeholder:text-gray-500 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 text-gray-800 dark:text-white"
          />
          <div
            class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-gray-500">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true">
              <path
                d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"
              ></path>
              <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"
              ></path>
            </svg>
          </div>
        </div>
        <div class="empty-feedback text-red-500 text-sm mt-1">
          Please provide your email address.
        </div>
        <div class="invalid-feedback text-red-500 text-sm mt-1">
          Please provide a valid email address.
        </div>
      </div>

      <!-- Subject Field -->
      <div class="relative">
        <label
          for="subject"
          class="text-sm font-medium text-gray-700 mb-1 block dark:text-gray-300"
          >Subject</label
        >
        <div class="relative">
          <select
            id="subject"
            name="subject"
            required
            class="w-full pl-10 px-4 py-3 bg-white/80 dark:bg-black/30 border border-gray-300 dark:border-gray-700 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 text-gray-800 dark:text-white appearance-none">
            <option value="" disabled selected>Select a subject</option>
            <option value="General Inquiry">General Inquiry</option>
            <option value="Technical Support">Technical Support</option>
            <option value="Billing Question">Billing Question</option>
            <option value="Partnership">Partnership Opportunity</option>
            <option value="Other">Other</option>
          </select>
          <div
            class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-gray-500">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true">
              <path
                fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"
                clip-rule="evenodd"></path>
            </svg>
          </div>
        </div>
        <div class="empty-feedback invalid-feedback text-red-500 text-sm mt-1">
          Please select a subject.
        </div>
      </div>

      <!-- Message Field -->
      <div class="relative">
        <label
          for="message"
          class="text-sm font-medium text-gray-700 mb-1 block dark:text-gray-300"
          >Your Message</label
        >
        <textarea
          id="message"
          name="message"
          required
          placeholder="Type your message here..."
          class="w-full px-4 py-3 bg-white/80 dark:bg-black/30 border border-gray-300 dark:border-gray-700 placeholder:text-gray-500 rounded-xl outline-none h-36 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 text-gray-800 dark:text-white"
        ></textarea>
        <div class="empty-feedback invalid-feedback text-red-500 text-sm mt-1">
          Please enter your message.
        </div>
      </div>

      <!-- Submit Button -->
      <div>
        <Button
          type="submit"
          size="lg"
          block
          class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:shadow-lg hover:shadow-indigo-500/20 transition-all duration-300">
          <span class="flex items-center justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true">
              <path
                d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"
              ></path>
            </svg>
            Send Message
          </span>
        </Button>
        <div id="result" class="mt-3 text-center"></div>
      </div>
    </div>
  </div>
</form>

<style>
  .invalid-feedback,
  .empty-feedback {
    display: none;
  }

  .was-validated :placeholder-shown:invalid ~ .empty-feedback {
    display: block;
  }

  .was-validated :not(:placeholder-shown):invalid ~ .invalid-feedback {
    display: block;
  }

  .is-invalid,
  .was-validated :invalid {
    border-color: #dc3545;
  }

  /* Form focus effect */
  input:focus,
  textarea:focus,
  select:focus {
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.4);
  }

  /* Custom select styling */
  select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.75rem center;
    background-repeat: no-repeat;
    background-size: 1.25em 1.25em;
    padding-right: 2.5rem;
  }

  /* Success animation */
  @keyframes success-pulse {
    0% {
      transform: scale(0.95);
      opacity: 0.8;
    }
    70% {
      transform: scale(1.05);
      opacity: 1;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  .text-green-500 {
    animation: success-pulse 0.5s ease-in-out;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("form") as HTMLFormElement;
    const result = document.getElementById("result") as HTMLElement;
    const inputs = form.querySelectorAll<
      HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement
    >("input:not([type=hidden]):not([type=checkbox]), textarea, select");

    // Add floating label effect
    inputs.forEach((input) => {
      input.addEventListener("focus", () => {
        input.parentElement?.classList.add("input-focused");
      });

      input.addEventListener("blur", () => {
        if (!input.value) {
          input.parentElement?.classList.remove("input-focused");
        }
      });

      // Initialize if there's a value
      if (input.value) {
        input.parentElement?.classList.add("input-focused");
      }
    });

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      form.classList.add("was-validated");

      if (!form.checkValidity()) {
        const invalidInput = form.querySelector(":invalid") as HTMLElement;
        if (invalidInput) {
          invalidInput.focus();

          // Scroll to the invalid input with smooth behavior
          invalidInput.scrollIntoView({ behavior: "smooth", block: "center" });
        }
        return;
      }

      // Show loading state
      const submitBtn = form.querySelector(
        "button[type='submit']"
      ) as HTMLButtonElement;
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Sending...
      `;

      result.innerHTML = "";
      result.className = "mt-3 text-center";

      const formData = new FormData(form);
      const object = Object.fromEntries(formData);
      const json = JSON.stringify(object);

      fetch("https://api.web3forms.com/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
        body: json,
      })
        .then(async (response) => {
          let json = await response.json();
          if (response.status == 200) {
            result.classList.add("text-green-500");
            result.innerHTML = `
              <div class="flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                ${json.message}
              </div>
            `;

            // Reset form
            form.reset();
            form.classList.remove("was-validated");

            // Reset all input states
            inputs.forEach((input) => {
              input.parentElement?.classList.remove("input-focused");
            });
          } else {
            console.log(response);
            result.classList.add("text-red-500");
            result.innerHTML = `
              <div class="flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                ${json.message}
              </div>
            `;
          }
        })
        .catch((error) => {
          console.log(error);
          result.classList.add("text-red-500");
          result.innerHTML = `
            <div class="flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
              Something went wrong!
            </div>
          `;
        })
        .finally(() => {
          // Reset button state
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalBtnText;

          // Hide result after 5 seconds
          setTimeout(() => {
            result.innerHTML = "";
            result.className = "mt-3 text-center";
          }, 5000);
        });
    });
  });
</script>
